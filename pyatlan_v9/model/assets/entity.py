# Auto-generated by PythonMsgspecRenderer.pkl - DO NOT EDIT
# SPDX-License-Identifier: Apache-2.0
# Copyright 2024 Atlan Pte. Ltd.

"""
Entity base class with all Apache Atlas top-level entity properties.

This module provides:
- AtlasClassification: Classification/tag assigned to an entity
- TermAssignment: Glossary term assignment (AtlasTermAssignmentHeader)
- Entity: Base class for all Atlas entities with top-level properties
"""

from __future__ import annotations

from typing import Any, Union

import msgspec
from msgspec import UNSET, UnsetType


class AtlasClassification(
    msgspec.Struct, kw_only=True, omit_defaults=True, rename="camel"
):
    """
    Atlas classification/tag assigned to an entity.

    Classifications are tags that can be assigned to entities with optional
    propagation settings and validity periods.
    """

    type_name: Union[str, UnsetType] = UNSET
    """The name of the classification type."""

    entity_guid: Union[str, UnsetType] = UNSET
    """The GUID of the entity this classification is assigned to."""

    entity_status: Union[str, UnsetType] = UNSET
    """The status of the entity (ACTIVE, DELETED)."""

    propagate: Union[bool, UnsetType] = UNSET
    """Whether this classification propagates to related entities."""

    remove_propagations_on_entity_delete: Union[bool, UnsetType] = UNSET
    """Whether to remove propagated classifications when the entity is deleted."""

    validity_periods: Union[list[dict[str, Any]], UnsetType] = UNSET
    """Time periods during which this classification is valid."""

    attributes: Union[dict[str, Any], UnsetType] = UNSET
    """Custom attributes for this classification."""


class TermAssignment(msgspec.Struct, kw_only=True, omit_defaults=True, rename="camel"):
    """
    Glossary term assignment to an entity (AtlasTermAssignmentHeader).

    Represents the association between an entity and a glossary term,
    including metadata about the assignment.
    """

    term_guid: Union[str, UnsetType] = UNSET
    """The GUID of the assigned glossary term."""

    relation_guid: Union[str, UnsetType] = UNSET
    """The GUID of the relationship between entity and term."""

    description: Union[str, UnsetType] = UNSET
    """Description of this term assignment."""

    display_text: Union[str, UnsetType] = UNSET
    """Display text for the assigned term."""

    expression: Union[str, UnsetType] = UNSET
    """Expression associated with this assignment."""

    created_by: Union[str, UnsetType] = UNSET
    """User who created this assignment."""

    steward: Union[str, UnsetType] = UNSET
    """Data steward responsible for this assignment."""

    source: Union[str, UnsetType] = UNSET
    """Source of this assignment."""

    confidence: Union[int, UnsetType] = UNSET
    """Confidence score for this assignment (0-100)."""

    status: Union[str, UnsetType] = UNSET
    """Status of the assignment (DISCOVERED, PROPOSED, IMPORTED, VALIDATED, DEPRECATED, OBSOLETE, OTHER)."""


class Entity(msgspec.Struct, kw_only=True, omit_defaults=True, rename="camel"):
    """
    Base class for all Atlas entities with top-level properties.

    This class contains all Apache Atlas entity properties that exist
    outside the 'attributes' object in the API response, such as:
    - Core identity (guid, typeName, status, version)
    - Timestamps (createTime, updateTime, createdBy, updatedBy)
    - Classifications and meanings
    - Additional metadata (labels, businessAttributes, etc.)

    All concrete entity types (Referenceable, Asset, Table, etc.) ultimately
    extend from this base class.
    """

    # Core identity
    guid: Union[str, UnsetType] = UNSET
    """Globally unique identifier for this entity."""

    type_name: Union[str, UnsetType] = UNSET
    """The type name of this entity."""

    super_type_names: Union[list[str], UnsetType] = UNSET
    """List of all supertype names in the type hierarchy (e.g., ["Referenceable", "Asset"])."""

    doc_id: Union[str, UnsetType] = UNSET
    """Document identifier used for search indexing."""

    status: Union[str, UnsetType] = UNSET
    """Entity status (ACTIVE, DELETED, PURGED)."""

    version: Union[int, UnsetType] = UNSET
    """Version number of this entity."""

    # Timestamps
    create_time: Union[int, UnsetType] = UNSET
    """Timestamp when this entity was created (epoch milliseconds)."""

    update_time: Union[int, UnsetType] = UNSET
    """Timestamp when this entity was last updated (epoch milliseconds)."""

    created_by: Union[str, UnsetType] = UNSET
    """Username of the user who created this entity."""

    updated_by: Union[str, UnsetType] = UNSET
    """Username of the user who last updated this entity."""

    # Classifications - typed for better validation
    classifications: Union[list[AtlasClassification], UnsetType] = UNSET
    """Classifications (tags) assigned to this entity."""

    classification_names: Union[list[str], UnsetType] = UNSET
    """Simple list of classification type names assigned to this entity."""

    # Meanings - typed for better validation
    meanings: Union[list[TermAssignment], UnsetType] = UNSET
    """Glossary term assignments for this entity."""

    # Labels
    labels: Union[list[str], UnsetType] = UNSET
    """Simple string labels attached to this entity."""

    # Additional metadata
    business_attributes: Union[dict[str, Any], UnsetType] = UNSET
    """Business metadata attributes for this entity."""

    custom_attributes: Union[dict[str, str], UnsetType] = UNSET
    """Custom key-value pairs for this entity."""

    pending_tasks: Union[list[str], UnsetType] = UNSET
    """Identifiers of pending tasks for this entity."""

    proxy: Union[bool, UnsetType] = UNSET
    """Whether this is a proxy entity."""

    is_incomplete: Union[bool, UnsetType] = UNSET
    """Whether this entity has incomplete data."""

    provenance_type: Union[int, UnsetType] = UNSET
    """Provenance type identifier for this entity."""

    home_id: Union[str, UnsetType] = UNSET
    """Home identifier for distributed Atlas systems."""

    # =========================================================================
    # Compatibility Methods (legacy API surface)
    # =========================================================================

    @property
    def attributes(self):
        """
        Backward-compatible accessor that returns self.

        In legacy Pydantic models, attributes were nested inside an
        `attributes` object. v9 uses flat fields, so this property
        returns self to allow legacy-style access like
        `asset.attributes.qualified_name`.
        """
        return self

    def validate_required(self):
        """
        Validate that required fields are present.

        Subclasses should override this to add specific validation.
        """
        pass

    def __getitem__(self, key):
        """
        Support dict-like access for backward compatibility.

        Allows `asset["qualifiedName"]` style access.
        """
        if not isinstance(key, str):
            raise KeyError(key)
        # Try camelCase to snake_case conversion
        import re

        snake_key = re.sub(r"(?<!^)(?=[A-Z])", "_", key).lower()
        if hasattr(self, snake_key):
            return getattr(self, snake_key)
        if hasattr(self, key):
            return getattr(self, key)
        raise KeyError(key)

    @staticmethod
    def _collapse_legacy_name(name: str) -> str:
        """
        Map legacy field names to v9 field names.

        Legacy Pydantic models used different snake_case conventions for
        some fields (e.g., asset_d_q_schedule_time_zone vs asset_dq_schedule_time_zone).
        This collapses single-letter segments: _d_q_ -> _dq_
        """
        import re

        return re.sub(r"_([a-z])_([a-z])_", r"_\1\2_", name)

    def __getattr__(self, name: str):
        """Fallback for legacy field name compatibility."""
        if name.startswith("_"):
            raise AttributeError(name)

        collapsed = self._collapse_legacy_name(name)
        if collapsed != name:
            try:
                return object.__getattribute__(self, collapsed)
            except AttributeError:
                pass

        raise AttributeError(
            f"'{type(self).__name__}' object has no attribute '{name}'"
        )

    def __setattr__(self, name: str, value):
        """Support legacy field name writes."""
        collapsed = self._collapse_legacy_name(name)
        if collapsed != name and collapsed in self.__struct_fields__:
            msgspec.Struct.__setattr__(self, collapsed, value)
        else:
            msgspec.Struct.__setattr__(self, name, value)
