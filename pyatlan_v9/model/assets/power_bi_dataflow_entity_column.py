# Auto-generated by PythonMsgspecRenderer.pkl - DO NOT EDIT
# SPDX-License-Identifier: Apache-2.0
# Copyright 2024 Atlan Pte. Ltd.

"""
PowerBIDataflowEntityColumn asset model with flattened inheritance.

This module provides:
- PowerBIDataflowEntityColumn: Flat asset class (easy to use)
- PowerBIDataflowEntityColumnAttributes: Nested attributes struct (extends AssetAttributes)
- PowerBIDataflowEntityColumnNested: Nested API format struct
"""

from __future__ import annotations

from typing import Union

from msgspec import UNSET, UnsetType

from pyatlan_v9.model.conversion_utils import (
    categorize_relationships,
    merge_relationships,
)
from pyatlan_v9.model.serde import Serde, get_serde
from pyatlan_v9.model.transform import register_asset

from .asset import Asset, AssetAttributes, AssetNested, AssetRelationshipAttributes
from .power_bi_related import RelatedPowerBIDataflow

# =============================================================================
# FLAT ASSET CLASS
# =============================================================================


@register_asset
class PowerBIDataflowEntityColumn(Asset):
    """
    Instance of a Power BI Dataflow Entity Column in Atlan. Dataflows are reusable transformation logic that can be shared by many datasets and reports inside Power BI. Each Dataflow has an Entity which represents an instance of SQL data from source, that has columns associated with it.
    """

    # Override type_name with PowerBIDataflowEntityColumn-specific default
    type_name: Union[str, UnsetType] = "PowerBIDataflowEntityColumn"

    power_bi_dataflow_entity_name: Union[str, None, UnsetType] = UNSET
    """Unique name of the dataflow entity in which this dataflow entity column exists."""

    power_bi_workspace_qualified_name: Union[str, None, UnsetType] = UNSET
    """Unique name of the workspace in which this dataflow entity column exists."""

    power_bi_dataflow_qualified_name: Union[str, None, UnsetType] = UNSET
    """Unique name of the dataflow in which this dataflow entity column exists."""

    power_bi_dataflow_entity_column_data_type: Union[str, None, UnsetType] = UNSET
    """Data type of this dataflow entity column."""

    power_bi_is_hidden: Union[bool, None, UnsetType] = UNSET
    """Whether this asset is hidden in Power BI (true) or not (false)."""

    power_bi_table_qualified_name: Union[str, None, UnsetType] = UNSET
    """Unique name of the Power BI table in which this asset exists."""

    power_bi_format_string: Union[str, None, UnsetType] = UNSET
    """Format of this asset, as specified in the FORMAT_STRING of the MDX cell property."""

    power_bi_endorsement: Union[str, None, UnsetType] = UNSET
    """Endorsement status of this asset, in Power BI."""

    power_bi_dataflow: Union[RelatedPowerBIDataflow, None, UnsetType] = UNSET
    """PowerBI Dataflow in which this Dataflow Entity Column exists."""

    # =========================================================================
    # Optimized Serialization Methods (override Asset base class)
    # =========================================================================

    def to_json(self, nested: bool = True, serde: Serde | None = None) -> str:
        """
        Convert to JSON string using optimized nested struct serialization.

        Args:
            nested: If True (default), use nested API format. If False, use flat format.
            serde: Optional Serde instance for encoder reuse. Uses shared singleton if None.

        Returns:
            JSON string representation
        """
        if serde is None:
            serde = get_serde()
        if nested:
            return _power_bi_dataflow_entity_column_to_nested_bytes(self, serde).decode(
                "utf-8"
            )
        else:
            return serde.encode(self).decode("utf-8")

    @staticmethod
    def from_json(
        json_data: Union[str, bytes], serde: Serde | None = None
    ) -> "PowerBIDataflowEntityColumn":
        """
        Create from JSON string or bytes using optimized nested struct deserialization.

        Args:
            json_data: JSON string or bytes to deserialize
            serde: Optional Serde instance for decoder reuse. Uses shared singleton if None.

        Returns:
            PowerBIDataflowEntityColumn instance
        """
        if isinstance(json_data, str):
            json_data = json_data.encode("utf-8")
        if serde is None:
            serde = get_serde()
        return _power_bi_dataflow_entity_column_from_nested_bytes(json_data, serde)


# =============================================================================
# NESTED FORMAT CLASSES
# =============================================================================


class PowerBIDataflowEntityColumnAttributes(AssetAttributes):
    """PowerBIDataflowEntityColumn-specific attributes for nested API format."""

    power_bi_dataflow_entity_name: Union[str, None, UnsetType] = UNSET
    """Unique name of the dataflow entity in which this dataflow entity column exists."""

    power_bi_workspace_qualified_name: Union[str, None, UnsetType] = UNSET
    """Unique name of the workspace in which this dataflow entity column exists."""

    power_bi_dataflow_qualified_name: Union[str, None, UnsetType] = UNSET
    """Unique name of the dataflow in which this dataflow entity column exists."""

    power_bi_dataflow_entity_column_data_type: Union[str, None, UnsetType] = UNSET
    """Data type of this dataflow entity column."""

    power_bi_is_hidden: Union[bool, None, UnsetType] = UNSET
    """Whether this asset is hidden in Power BI (true) or not (false)."""

    power_bi_table_qualified_name: Union[str, None, UnsetType] = UNSET
    """Unique name of the Power BI table in which this asset exists."""

    power_bi_format_string: Union[str, None, UnsetType] = UNSET
    """Format of this asset, as specified in the FORMAT_STRING of the MDX cell property."""

    power_bi_endorsement: Union[str, None, UnsetType] = UNSET
    """Endorsement status of this asset, in Power BI."""


class PowerBIDataflowEntityColumnRelationshipAttributes(AssetRelationshipAttributes):
    """PowerBIDataflowEntityColumn-specific relationship attributes for nested API format."""

    power_bi_dataflow: Union[RelatedPowerBIDataflow, None, UnsetType] = UNSET
    """PowerBI Dataflow in which this Dataflow Entity Column exists."""


class PowerBIDataflowEntityColumnNested(AssetNested):
    """PowerBIDataflowEntityColumn in nested API format for high-performance serialization."""

    attributes: Union[PowerBIDataflowEntityColumnAttributes, UnsetType] = UNSET
    relationship_attributes: Union[
        PowerBIDataflowEntityColumnRelationshipAttributes, UnsetType
    ] = UNSET
    append_relationship_attributes: Union[
        PowerBIDataflowEntityColumnRelationshipAttributes, UnsetType
    ] = UNSET
    remove_relationship_attributes: Union[
        PowerBIDataflowEntityColumnRelationshipAttributes, UnsetType
    ] = UNSET


# =============================================================================
# CONVERSION FUNCTIONS
# =============================================================================


def _power_bi_dataflow_entity_column_to_nested(
    power_bi_dataflow_entity_column: PowerBIDataflowEntityColumn,
) -> PowerBIDataflowEntityColumnNested:
    """Convert flat PowerBIDataflowEntityColumn to nested format."""
    attrs = PowerBIDataflowEntityColumnAttributes(
        power_bi_dataflow_entity_name=power_bi_dataflow_entity_column.power_bi_dataflow_entity_name,
        power_bi_workspace_qualified_name=power_bi_dataflow_entity_column.power_bi_workspace_qualified_name,
        power_bi_dataflow_qualified_name=power_bi_dataflow_entity_column.power_bi_dataflow_qualified_name,
        power_bi_dataflow_entity_column_data_type=power_bi_dataflow_entity_column.power_bi_dataflow_entity_column_data_type,
        power_bi_is_hidden=power_bi_dataflow_entity_column.power_bi_is_hidden,
        power_bi_table_qualified_name=power_bi_dataflow_entity_column.power_bi_table_qualified_name,
        power_bi_format_string=power_bi_dataflow_entity_column.power_bi_format_string,
        power_bi_endorsement=power_bi_dataflow_entity_column.power_bi_endorsement,
    )
    # Categorize relationships by save semantic (REPLACE, APPEND, REMOVE)
    rel_fields: list[str] = ["power_bi_dataflow"]
    replace_rels, append_rels, remove_rels = categorize_relationships(
        power_bi_dataflow_entity_column,
        rel_fields,
        PowerBIDataflowEntityColumnRelationshipAttributes,
    )
    return PowerBIDataflowEntityColumnNested(
        guid=power_bi_dataflow_entity_column.guid,
        type_name=power_bi_dataflow_entity_column.type_name,
        status=power_bi_dataflow_entity_column.status,
        version=power_bi_dataflow_entity_column.version,
        create_time=power_bi_dataflow_entity_column.create_time,
        update_time=power_bi_dataflow_entity_column.update_time,
        created_by=power_bi_dataflow_entity_column.created_by,
        updated_by=power_bi_dataflow_entity_column.updated_by,
        classifications=power_bi_dataflow_entity_column.classifications,
        classification_names=power_bi_dataflow_entity_column.classification_names,
        meanings=power_bi_dataflow_entity_column.meanings,
        labels=power_bi_dataflow_entity_column.labels,
        business_attributes=power_bi_dataflow_entity_column.business_attributes,
        custom_attributes=power_bi_dataflow_entity_column.custom_attributes,
        pending_tasks=power_bi_dataflow_entity_column.pending_tasks,
        proxy=power_bi_dataflow_entity_column.proxy,
        is_incomplete=power_bi_dataflow_entity_column.is_incomplete,
        provenance_type=power_bi_dataflow_entity_column.provenance_type,
        home_id=power_bi_dataflow_entity_column.home_id,
        attributes=attrs,
        relationship_attributes=replace_rels,
        append_relationship_attributes=append_rels,
        remove_relationship_attributes=remove_rels,
    )


def _power_bi_dataflow_entity_column_from_nested(
    nested: PowerBIDataflowEntityColumnNested,
) -> PowerBIDataflowEntityColumn:
    """Convert nested format to flat PowerBIDataflowEntityColumn."""
    attrs = (
        nested.attributes
        if nested.attributes is not UNSET
        else PowerBIDataflowEntityColumnAttributes()
    )
    # Merge relationships from all three buckets
    rel_fields: list[str] = ["power_bi_dataflow"]
    merged_rels = merge_relationships(
        nested.relationship_attributes,
        nested.append_relationship_attributes,
        nested.remove_relationship_attributes,
        rel_fields,
        PowerBIDataflowEntityColumnRelationshipAttributes,
    )
    return PowerBIDataflowEntityColumn(
        guid=nested.guid,
        type_name=nested.type_name,
        status=nested.status,
        version=nested.version,
        create_time=nested.create_time,
        update_time=nested.update_time,
        created_by=nested.created_by,
        updated_by=nested.updated_by,
        classifications=nested.classifications,
        classification_names=nested.classification_names,
        meanings=nested.meanings,
        labels=nested.labels,
        business_attributes=nested.business_attributes,
        custom_attributes=nested.custom_attributes,
        pending_tasks=nested.pending_tasks,
        proxy=nested.proxy,
        is_incomplete=nested.is_incomplete,
        provenance_type=nested.provenance_type,
        home_id=nested.home_id,
        power_bi_dataflow_entity_name=attrs.power_bi_dataflow_entity_name,
        power_bi_workspace_qualified_name=attrs.power_bi_workspace_qualified_name,
        power_bi_dataflow_qualified_name=attrs.power_bi_dataflow_qualified_name,
        power_bi_dataflow_entity_column_data_type=attrs.power_bi_dataflow_entity_column_data_type,
        power_bi_is_hidden=attrs.power_bi_is_hidden,
        power_bi_table_qualified_name=attrs.power_bi_table_qualified_name,
        power_bi_format_string=attrs.power_bi_format_string,
        power_bi_endorsement=attrs.power_bi_endorsement,
        # Merged relationship attributes
        **merged_rels,
    )


def _power_bi_dataflow_entity_column_to_nested_bytes(
    power_bi_dataflow_entity_column: PowerBIDataflowEntityColumn, serde: Serde
) -> bytes:
    """Convert flat PowerBIDataflowEntityColumn to nested JSON bytes."""
    return serde.encode(
        _power_bi_dataflow_entity_column_to_nested(power_bi_dataflow_entity_column)
    )


def _power_bi_dataflow_entity_column_from_nested_bytes(
    data: bytes, serde: Serde
) -> PowerBIDataflowEntityColumn:
    """Convert nested JSON bytes to flat PowerBIDataflowEntityColumn."""
    nested = serde.decode(data, PowerBIDataflowEntityColumnNested)
    return _power_bi_dataflow_entity_column_from_nested(nested)
