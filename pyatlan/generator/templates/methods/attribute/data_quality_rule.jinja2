
        @staticmethod
        def _get_template_config_value(
            config_value: str,
            property_name: Optional[str] = None,
            value_key: str = "default",
        ):
            if not config_value:
                return None

            try:
                config_json = json.loads(config_value)

                if property_name:
                    properties = config_json.get("properties", {})
                    field = properties.get(property_name, {})
                    return field.get(value_key)
                else:
                    return config_json.get(value_key)
            except (json.JSONDecodeError, KeyError):
                return None

        @staticmethod
        def _validate_template_features(
            rule_type: str,
            rule_conditions: Optional[str],
            row_scope_filtering_enabled: Optional[bool],
            template_config: Optional[dict],
            threshold_compare_operator: Optional[
                DataQualityRuleThresholdCompareOperator
            ] = None,
            asset: Optional[Asset] = None,
        ) -> Optional[DataQualityRuleThresholdCompareOperator]:
            if not template_config or not template_config.get("config"):
                return None

            config = template_config["config"]

            if (
                rule_conditions
                and config.dq_rule_template_config_rule_conditions is None
            ):
                raise ErrorCode.DQ_RULE_TYPE_NOT_SUPPORTED.exception_with_parameters(
                    rule_type, "rule conditions"
                )

            if row_scope_filtering_enabled:
                advanced_settings = (
                    config.dq_rule_template_config_advanced_settings or ""
                )
                if "dqRuleRowScopeFilteringEnabled" not in str(advanced_settings):
                    raise ErrorCode.DQ_RULE_TYPE_NOT_SUPPORTED.exception_with_parameters(
                        rule_type, "row scope filtering"
                    )

                if asset and not getattr(
                    asset,
                    "asset_d_q_row_scope_filter_column_qualified_name",
                    None,
                ):
                    raise ErrorCode.DQ_ROW_SCOPE_FILTER_COLUMN_MISSING.exception_with_parameters(
                        getattr(asset, "qualified_name", "unknown")
                    )

            if rule_conditions:
                allowed_rule_conditions = (
                    DataQualityRule.Attributes._get_template_config_value(
                        config.dq_rule_template_config_rule_conditions or "",
                        None,
                        "enum",
                    )
                )
                if allowed_rule_conditions:
                    try:
                        rule_conditions_json = json.loads(rule_conditions)
                        conditions = rule_conditions_json.get("conditions", [])
                        if len(conditions) != 1:
                            raise ErrorCode.DQ_RULE_CONDITIONS_INVALID.exception_with_parameters(
                                f"exactly one condition required, found {len(conditions)}"
                            )
                        condition_type = conditions[0].get("type")
                    except json.JSONDecodeError:
                        condition_type = rule_conditions

                    if condition_type not in allowed_rule_conditions:
                        raise ErrorCode.DQ_RULE_CONDITIONS_INVALID.exception_with_parameters(
                            f"condition type '{condition_type}' not supported, allowed: {allowed_rule_conditions}"
                        )

                if threshold_compare_operator is None:
                    return DataQualityRuleThresholdCompareOperator.EQUAL
                elif (
                    threshold_compare_operator
                    != DataQualityRuleThresholdCompareOperator.EQUAL
                ):
                    raise ErrorCode.INVALID_PARAMETER_VALUE.exception_with_parameters(
                        f"threshold_compare_operator={threshold_compare_operator.value}",
                        "threshold_compare_operator",
                        "EQUAL when rule_conditions are provided",
                    )

            if threshold_compare_operator is not None:
                allowed_operators = (
                    DataQualityRule.Attributes._get_template_config_value(
                        config.dq_rule_template_config_threshold_object,
                        "dqRuleTemplateConfigThresholdCompareOperator",
                        "enum",
                    )
                )
                if (
                    allowed_operators
                    and threshold_compare_operator.value not in allowed_operators
                ):
                    raise ErrorCode.INVALID_PARAMETER_VALUE.exception_with_parameters(
                        f"threshold_compare_operator={threshold_compare_operator.value}",
                        "threshold_compare_operator",
                        f"must be one of {allowed_operators}",
                    )
            elif threshold_compare_operator is None:
                default_value = DataQualityRule.Attributes._get_template_config_value(
                    config.dq_rule_template_config_threshold_object,
                    "dqRuleTemplateConfigThresholdCompareOperator",
                    "default",
                )
                if default_value:
                    threshold_compare_operator = (
                        DataQualityRuleThresholdCompareOperator(default_value)
                    )

            return (
                threshold_compare_operator
                or DataQualityRuleThresholdCompareOperator.LESS_THAN_EQUAL
            )

        @staticmethod
        def _generate_uuid():
            d = int(time.time() * 1000)
            random_bytes = uuid.uuid4().bytes
            rand_index = 0

            def replace_char(c):
                nonlocal d, rand_index
                r = (d + random_bytes[rand_index % 16]) % 16
                rand_index += 1
                d = d // 16
                if c == "x":
                    return hex(r)[2:]
                elif c == "y":
                    return hex((r & 0x3) | 0x8)[2:]  # y -> 8 to b
                else:
                    return c

            template = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"
            uuid_str = "".join(replace_char(c) if c in "xy" else c for c in template)
            return uuid_str

        @classmethod
        @init_guid
        def creator(
            cls,
            *,
            client: AtlanClient,
            rule_name: str,
            rule_type: str,
            asset: Asset,
            threshold_compare_operator: DataQualityRuleThresholdCompareOperator,
            threshold_value: int,
            alert_priority: DataQualityRuleAlertPriority,
            column: Optional[Asset] = None,
            threshold_unit: Optional[DataQualityRuleThresholdUnit] = None,
            dimension: Optional[DataQualityDimension] = None,
            custom_sql: Optional[str] = None,
            description: Optional[str] = None,
            rule_conditions: Optional[str] = None,
            row_scope_filtering_enabled: Optional[bool] = False,
        ) -> DataQualityRule.Attributes:
            template_config = client.dq_template_config_cache.get_template_config(
                rule_type
            )

            if template_config is None:
                raise ErrorCode.DQ_RULE_NOT_FOUND.exception_with_parameters(rule_type)

            template_rule_name = template_config.get("name")
            template_qualified_name = template_config.get("qualified_name")

            if dimension is None:
                dimension = template_config.get("dimension")

            if threshold_unit is None:
                config = template_config.get("config")
                if config is not None:
                    threshold_unit = (
                        DataQualityRule.Attributes._get_template_config_value(
                            config.dq_rule_template_config_threshold_object,
                            "dqRuleTemplateConfigThresholdUnit",
                            "default",
                        )
                    )

            attr_dq = DataQualityRule.Attributes(
                name="",
                dq_rule_config_arguments=DataQualityRuleConfigArguments(
                    dq_rule_threshold_object=DataQualityRuleThresholdObject(
                        dq_rule_threshold_compare_operator=threshold_compare_operator,
                        dq_rule_threshold_value=threshold_value,
                        dq_rule_threshold_unit=threshold_unit,
                    ),
                    dq_rule_config_rule_conditions=rule_conditions,
                ),
                dq_rule_base_dataset_qualified_name=asset.qualified_name,
                dq_rule_alert_priority=alert_priority,
                dq_rule_row_scope_filtering_enabled=row_scope_filtering_enabled,
                dq_rule_source_sync_status=DataQualitySourceSyncStatus.IN_PROGRESS,
                dq_rule_status=DataQualityRuleStatus.ACTIVE,
                dq_rule_base_dataset=asset,
                qualified_name=f"{asset.qualified_name}/rule/{str(cls._generate_uuid())}",
                dq_rule_dimension=dimension,
                dq_rule_template_name=template_rule_name,
                dq_rule_template=DataQualityRuleTemplate.ref_by_qualified_name(
                    qualified_name=template_qualified_name  # type: ignore
                ),
            )

            if column is not None:
                attr_dq.dq_rule_base_column_qualified_name = column.qualified_name
                attr_dq.dq_rule_base_column = column  # type: ignore

            if custom_sql is not None:
                attr_dq.dq_rule_custom_s_q_l = custom_sql
                attr_dq.display_name = rule_name
                if description is not None:
                    attr_dq.user_description = description

            return attr_dq
